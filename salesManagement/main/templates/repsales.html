{%extends 'repbase.html'%}
{% load i18n %}

<!DOCTYPE html>
<html lang="en">

<head> {%block head%}
    <title>{% trans "Sales" %}</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script>
        $('document').ready(function () {
            $('.nav-item').find('li.active').removeClass('active');
            $('#sales').addClass('active');
            $.ajax({
                 url: "/api/feeprogVS/",
                 type: "GET",
                 success: function(data){
                     data['results'].forEach(el => {$('#feeProgSelect').append("<option value='"+el['name']+"'>"+el['name']+"</option>");});
                 }
             });
        });
    </script>
    {%endblock%}
</head>

<body>
    {%block body%}
    <h3 class="titels">{% trans 'Sales Report' %}</h3>
    <div id="myGrid" class="ag-theme-balham gridclass"></div>
    <script>
        // specify the columns
        var columnDefs = [
            { headerName: {% trans "'Product Type'" %}, field: "product_type", sortable: true, filter: true, checkboxSelection: true },
            { headerName: {% trans "'Quantity'" %}, field: "quant", sortable: true, filter: true },
            { headerName: {% trans "'Sale Price'" %}, field: "saleprice", sortable: true, filter: true },
            { headerName: {% trans "'Unit Profit'" %}, field: "unitprofit", sortable: true, filter: true },
            { headerName: {% trans "'Unit Profit %'" %}, field: "profitpercent", sortable: true, filter: true },
            { headerName: {% trans "'Total Profit'" %}, field: "totalprofit", sortable: true, filter: true },
            { headerName: {% trans "'Order ID'" %}, field: "orderid", sortable: true, filter: true },
            { headerName: {% trans "'Date'" %}, field: "date", sortable: true, filter: true },
            { headerName: {% trans "'Batch ID'" %}, field: "batchid", filter: true }];
        // let the grid know which columns and what data to use
        var gridOptions = { columnDefs: columnDefs, rowSelection: 'multiple' };
        // create the grid passing in the div to use together with the columns & data we want to use
        new agGrid.Grid(document.querySelector('#myGrid'), gridOptions);
        $.ajax({url: "/api/salesVS/",type: "GET",success: function(data){gridOptions.api.setRowData(data["results"]);}});
        function Deletesales() {
            $.ajaxSetup({
                beforeSend: function (xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                    }
                }
            });
            var selectedNodes = gridOptions.api.getSelectedNodes()
            var selectedData = selectedNodes.map(function (node) { return node.data })
            var orderid = selectedData.map(function (node) { return node.orderid }).join(',')
            $.ajax({ type: "DELETE", url: '/api/salescustom/' + orderid + '/', headers: {'feeprog': $('#feeProgSelect').val()}});
        }
    </script>
    {%endblock%}
</body>

</html>