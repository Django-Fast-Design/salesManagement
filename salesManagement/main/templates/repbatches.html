{%extends 'base.html'%}

<!DOCTYPE html>
<html lang="en">

<head> {%block head%}
  <title>Batches</title>
  <script>
    $('document').ready(function () {
      $('.nav-item').find('li.active').removeClass('active');
      $('#batches').addClass('active');


    });
  </script>
  <script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.noStyle.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/dist/styles/ag-grid.css">
  <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/dist/styles/ag-theme-balham.css"> {%endblock%}

</head>

<body>
  {%block body%}
  <h3>Batches Report</h3>
  <button onclick="DeleteBatch()">Delete Batch</button>
  <span></span>
  <div id="myGrid" style="max-height:100%;max-width: 100%;height:900px;" class="ag-theme-balham"></div>
  <script type="text/javascript" charset="utf-8">
    // specify the columns
    var columnDefs = [
      { headerName: "Product Type", field: "product_type", sortable: true, filter: true,checkboxSelection: true },
      { headerName: "Unit Price", field: "unit_price", sortable: true, filter: true},
      { headerName: "Quantity", field: "quant", sortable: true, filter: true },
      { headerName: "Batch ID", field: "batchid", sortable: true, filter: true },
      { headerName: "Stock Cost", field: "total_cost", sortable: true, filter: true },
      { headerName: "Min selling price", field: "minselling", sortable: true, filter: true },
      { headerName: "Selling price W/ 10% profit", field: "profit10", sortable: true, filter: true },
      { headerName: "Fee Prog", field:"feeprog", sortable: true, filter: true }];

    // let the grid know which columns and what data to use
    var gridOptions = { columnDefs: columnDefs,  rowSelection: 'multiple' };
    // create the grid passing in the div to use together with the columns & data we want to use
    new agGrid.Grid(document.querySelector('#myGrid'), gridOptions);
    fetch('/api/batchVS/').then(function (response) {
      return response.json();
    }).then(function (data) {
      gridOptions.api.setRowData(data["results"]);
    })
    function DeleteBatch() {
    var selectedNodes = gridOptions.api.getSelectedNodes()  
    var selectedData = selectedNodes.map( function(node) { return node.data })
    var batchid = selectedData.map( function(node) { return node.batchid }).join(',')
    console.log(fetch('/api/batchVS/' + batchid+'/', {method: 'delete'}).then(response => response.json()));
}
  </script>

  {%endblock%}
</body>

</html>